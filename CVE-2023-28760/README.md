# TP-Link AX1800 WiFi 6 Router - Memory Corruption Vulnerability (Exploit)
This repository contains an exploit code that demonstrates a memory corruption
vulnerability in the TP-Link AX1800 WiFi 6 Router Archer AX20(EU). The
vulnerability exists in the ".TPDLNA/files.db" database file, which is created
on the USB device when Media Sharing is enabled on the router. An attacker with
access to the router's media server via Samba or FTP can exploit this
vulnerability, potentially leading to unauthorized access and control of the
router.

# Vulnerability Details
- Product: TP-Link AX1800 WiFi 6 Router Archer AX20(EU)
- Firmware Version: 2.1.6 Build 20220128 rel.15823(4555)
- Service: MiniDLNA version 1.1.2
- CVE: CVE-2023-28760

# Exploit Overview
The exploit leverages a stack-based buffer overflow vulnerability in the
MiniDLNA service, allowing an attacker to overwrite the stack and potentially
execute arbitrary code on the router. The exploit code provided in this
repository is designed to:

1. Create a database connection and insert data into the database.
2. Upload the "files.db" file to the target router using either SMB or FTP.
3. Verify the target's vulnerability by performing a hash check on a remotely served JPG file.
4. Build a carefully crafted payload to exploit the vulnerability.
5. Create the appropriate database structure.
6. Trigger the buffer overflow by sending a specially crafted HTTP request to the target router.

# Warning
This code is provided for educational purposes only and should not be used
without a thorough understanding of its effects and potential legal
consequences. It is essential to ensure that any systems you are responsible for
are properly secured and updated to prevent exploitation.

# Usage
Follow the instructions provided in the repository to compile and execute the 
exploit code. Ensure you have the appropriate permissions and knowledge of the
target system before attempting to use this code.

Please note that the exploit code is intended for demonstration purposes only
and should not be used maliciously. Always obtain proper authorization before
testing the vulnerability on any system.

```
usage: CVE-2023-28760.py [-h] target {ftp,smb}

TP-Link AX1800 WiFi 6 Router (Archer AX20) RCE Exploit

positional arguments:
  target      The target IP address of the router
  {ftp,smb}   The protocol to exploit (ftp or smb)
```

# References
- https://www.tecsecurity.io/blog/tp-link_ax1800
